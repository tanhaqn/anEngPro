<div class="min-h-screen bg-background-light dark:bg-background-dark font-display text-white" *ngIf="course">

    <!-- Mobile View (md:hidden) -->
    <div class="relative flex h-screen w-full flex-col overflow-hidden md:hidden">
        <div class="flex h-full grow flex-col">
            <div class="flex flex-1 justify-center">
                <div class="flex w-full max-w-md flex-col bg-background-light dark:bg-background-dark">
                    <!-- Header -->
                    <header class="flex items-center justify-between whitespace-nowrap px-4 py-3">
                        <div class="flex items-center gap-2 text-white">
                            <a [routerLink]="['/vocabulary', course.id]"
                                class="flex h-10 w-10 items-center justify-center rounded-lg text-white hover:bg-white/10 transition-colors">
                                <span class="material-symbols-outlined text-2xl">close</span>
                            </a>
                        </div>
                        <div class="flex flex-1 items-center gap-3 px-2">
                            <div class="h-2 w-full rounded bg-slate-700">
                                <div class="h-2 rounded bg-primary transition-all duration-300"
                                    [style.width.%]="((currentQuestionIndex + 1) / questions.length) * 100"></div>
                            </div>
                            <p class="text-sm font-bold text-primary">{{ currentQuestionIndex + 1 }}/{{ questions.length
                                }}</p>
                        </div>
                        <div class="flex items-center gap-4 text-white">
                            <button
                                class="flex h-10 w-10 items-center justify-center rounded-lg text-white hover:bg-white/10 transition-colors">
                                <span class="material-symbols-outlined text-2xl">more_vert</span>
                            </button>
                        </div>
                    </header>

                    <main class="flex flex-1 flex-col justify-between overflow-y-auto p-4 md:p-6">
                        <div class="flex-grow" *ngIf="!showResult && questions.length > 0">
                            <p class="mb-2 text-base font-medium text-slate-400">Chọn nghĩa đúng của từ</p>
                            <div class="mb-8 flex items-center justify-center gap-3">
                                <h1 class="text-4xl font-bold leading-tight tracking-tight text-white">{{
                                    questions[currentQuestionIndex].questionText }}</h1>
                                <button
                                    class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-slate-300 hover:bg-white/10">
                                    <span class="material-symbols-outlined text-2xl">volume_up</span>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div *ngFor="let option of questions[currentQuestionIndex].options; let i = index"
                                    (click)="selectOption(option.id)"
                                    [class.border-primary]="questions[currentQuestionIndex].selectedId === option.id"
                                    [class.bg-primary/10]="questions[currentQuestionIndex].selectedId === option.id"
                                    [class.border-slate-700]="questions[currentQuestionIndex].selectedId !== option.id"
                                    [class.bg-slate-800/50]="questions[currentQuestionIndex].selectedId !== option.id"
                                    class="flex cursor-pointer items-center gap-4 rounded-xl border-2 p-4 transition-all hover:border-primary hover:bg-primary/10">
                                    <div class="flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg text-sm font-bold text-white"
                                        [class.bg-primary]="questions[currentQuestionIndex].selectedId === option.id"
                                        [class.bg-slate-700]="questions[currentQuestionIndex].selectedId !== option.id">
                                        {{ ['A', 'B', 'C', 'D'][i] }}
                                    </div>
                                    <p class="text-base font-medium text-slate-200">{{ option.text }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Result View Mobile -->
                        <div *ngIf="showResult" class="flex flex-col items-center justify-center h-full text-center">
                            <div
                                class="mb-6 inline-flex h-24 w-24 items-center justify-center rounded-full bg-primary/20">
                                <span class="material-symbols-outlined text-5xl text-primary">emoji_events</span>
                            </div>
                            <h3 class="mb-4 text-3xl font-bold text-white">Hoàn thành!</h3>
                            <p class="mb-8 text-xl text-gray-300">Bạn đã đạt được <span
                                    class="font-bold text-primary">{{ score }}</span> điểm.</p>
                            <div class="flex justify-center gap-4 w-full">
                                <button (click)="resetGame()"
                                    class="flex-1 rounded-xl bg-slate-700 px-6 py-4 font-bold text-white hover:bg-slate-600">Làm
                                    lại</button>
                                <a [routerLink]="['/vocabulary', course.id]"
                                    class="flex-1 rounded-xl bg-primary px-6 py-4 font-bold text-white hover:bg-primary/90">Về
                                    bài học</a>
                            </div>
                        </div>
                    </main>

                    <footer
                        class="w-full max-w-md bg-gradient-to-t from-background-dark via-background-dark/90 to-transparent p-4 pt-8"
                        *ngIf="!showResult">
                        <button (click)="nextQuestion()"
                            class="flex h-14 w-full items-center justify-center rounded-xl bg-primary text-lg font-bold leading-normal tracking-wide text-white shadow-lg shadow-primary/30 transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:bg-slate-700 disabled:text-slate-400 disabled:shadow-none">
                            {{ currentQuestionIndex < questions.length - 1 ? 'Câu tiếp theo' : 'Xem kết quả' }}
                                </button>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop View (hidden md:block) -->
    <main class="hidden md:block mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <div class="mb-6 flex items-center gap-2 text-sm text-gray-400">
            <a routerLink="/vocabulary" class="hover:text-white transition-colors">Luyện tập</a>
            <span class="material-symbols-outlined text-xs">chevron_right</span>
            <a [routerLink]="['/vocabulary', course.id]" class="hover:text-white transition-colors">Từ vựng {{
                course.title }}</a>
            <span class="material-symbols-outlined text-xs">chevron_right</span>
            <span class="text-white">Bài tập Trắc nghiệm</span>
        </div>

        <div class="grid gap-8 lg:grid-cols-3">
            <!-- Main Quiz Area -->
            <div class="lg:col-span-2">
                <!-- Header -->
                <div class="mb-8">
                    <h2 class="text-2xl sm:text-3xl font-bold text-white">Quiz: {{ course.title }}</h2>
                    <p class="mt-2 text-gray-400">Chọn đáp án đúng nhất để hoàn thành câu.</p>
                </div>

                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="h-2 w-full rounded-full bg-[#334155]">
                        <div class="h-2 rounded-full bg-primary transition-all duration-300"
                            [style.width.%]="((currentQuestionIndex + 1) / questions.length) * 100"></div>
                    </div>
                </div>

                <!-- Question Card -->
                <div *ngIf="!showResult && questions.length > 0"
                    class="rounded-2xl bg-[#1e293b] p-6 sm:p-8 shadow-xl border border-white/5">
                    <div class="mb-8">
                        <span
                            class="mb-4 inline-block rounded-lg bg-primary/10 px-3 py-1 text-sm font-bold text-primary">
                            Câu hỏi {{ currentQuestionIndex + 1 }}
                        </span>
                        <h3 class="text-xl sm:text-2xl font-bold leading-relaxed text-white">
                            {{ questions[currentQuestionIndex].questionText }}
                        </h3>
                    </div>

                    <div class="grid gap-4">
                        <button *ngFor="let option of questions[currentQuestionIndex].options"
                            (click)="selectOption(option.id)" [disabled]="showFeedback"
                            [class.bg-primary]="questions[currentQuestionIndex].selectedId === option.id && !showFeedback"
                            [class.bg-[#263345]]="questions[currentQuestionIndex].selectedId !== option.id"
                            [class.bg-green-600]="showFeedback && option.id === questions[currentQuestionIndex].correctId"
                            [class.bg-red-600]="showFeedback && questions[currentQuestionIndex].selectedId === option.id && option.id !== questions[currentQuestionIndex].correctId"
                            class="group flex items-center gap-4 rounded-xl border border-white/10 p-4 text-left transition-all hover:bg-[#334155]">
                            <div
                                class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-white/10 text-lg font-bold text-white group-hover:bg-white/20">
                                {{ option.label }}
                            </div>
                            <span class="text-lg font-medium text-white">{{ option.text }}</span>
                        </button>
                    </div>
                </div>

                <!-- Feedback Section -->
                <div *ngIf="showFeedback" class="mt-6 rounded-2xl border border-green-500/20 bg-green-500/10 p-6">
                    <div class="flex items-start justify-between">
                        <div>
                            <h4 class="mb-2 text-lg font-bold text-green-400"
                                *ngIf="questions[currentQuestionIndex].isCorrect">
                                Chính xác!</h4>
                            <h4 class="mb-2 text-lg font-bold text-red-400"
                                *ngIf="!questions[currentQuestionIndex].isCorrect">
                                Chưa chính xác!</h4>
                            <p class="text-gray-300">"{{ getCorrectAnswerText() }}" là đáp án đúng.</p>
                        </div>
                        <button (click)="nextQuestion()"
                            class="flex items-center gap-2 rounded-lg bg-primary px-6 py-2 text-sm font-bold text-white hover:bg-primary/90">
                            {{ currentQuestionIndex < questions.length - 1 ? 'Câu tiếp theo' : 'Xem kết quả' }} <span
                                class="material-symbols-outlined">arrow_forward</span>
                        </button>
                    </div>
                </div>

                <!-- Result View -->
                <div *ngIf="showResult" class="rounded-2xl bg-[#1e293b] p-12 text-center border border-white/5">
                    <div class="mb-6 inline-flex h-24 w-24 items-center justify-center rounded-full bg-primary/20">
                        <span class="material-symbols-outlined text-5xl text-primary">emoji_events</span>
                    </div>
                    <h3 class="mb-4 text-3xl font-bold text-white">Hoàn thành!</h3>
                    <p class="mb-8 text-xl text-gray-300">Bạn đã đạt được <span class="font-bold text-primary">{{ score
                            }}</span> điểm.</p>
                    <div class="flex justify-center gap-4">
                        <button (click)="resetGame()"
                            class="rounded-lg bg-white/10 px-8 py-3 font-bold text-white hover:bg-white/20">Làm
                            lại</button>
                        <a [routerLink]="['/vocabulary', course.id]"
                            class="rounded-lg bg-primary px-8 py-3 font-bold text-white hover:bg-primary/90">Về bài
                            học</a>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <div class="rounded-2xl bg-[#1e293b] p-6 border border-white/5">
                    <h3 class="mb-6 text-lg font-bold text-white">Thông tin</h3>
                    <div class="space-y-6">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="material-symbols-outlined text-gray-400">schedule</span>
                                <span class="text-gray-300">Thời gian</span>
                            </div>
                            <span class="font-bold text-white">05:42</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="material-symbols-outlined text-gray-400">check_circle</span>
                                <span class="text-gray-300">Đã trả lời</span>
                            </div>
                            <span class="font-bold text-white">{{ currentQuestionIndex }}/{{ questions.length }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="material-symbols-outlined text-gray-400">stars</span>
                                <span class="text-gray-300">Điểm số</span>
                            </div>
                            <span class="font-bold text-white">{{ score }}</span>
                        </div>
                    </div>
                </div>

                <div class="mt-6 rounded-2xl bg-[#1e293b] p-6 border border-white/5">
                    <h3 class="mb-4 text-lg font-bold text-white">Hỗ trợ</h3>
                    <div class="space-y-3">
                        <button
                            class="flex w-full items-center justify-center gap-2 rounded-lg bg-[#334155] py-3 text-sm font-bold text-white hover:bg-[#475569]">
                            <span class="material-symbols-outlined text-lg">lightbulb</span>
                            Gợi ý
                        </button>
                        <button
                            class="flex w-full items-center justify-center gap-2 rounded-lg bg-[#334155] py-3 text-sm font-bold text-white hover:bg-[#475569]">
                            <span class="material-symbols-outlined text-lg">flag</span>
                            Báo cáo lỗi
                        </button>
                    </div>
                </div>

                <button
                    class="mt-6 w-full rounded-xl bg-[#22c55e] py-4 text-lg font-bold text-white hover:bg-[#16a34a] shadow-lg shadow-green-500/20">
                    Nộp bài
                </button>
            </div>
        </div>
    </main>
</div>