<div class="min-h-screen bg-background-light dark:bg-background-dark font-display text-white" *ngIf="course">

    <!-- Mobile View (md:hidden) -->
    <div class="relative flex h-screen w-full flex-col overflow-hidden md:hidden">
        <div class="flex h-full grow flex-col">
            <div class="flex flex-1 justify-center">
                <div class="flex w-full max-w-md flex-col bg-background-light dark:bg-background-dark">
                    <!-- Header -->
                    <header
                        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-white/10 px-4 py-3">
                        <div class="flex items-center gap-4 text-white">
                            <a [routerLink]="['/vocabulary', course.id]"
                                class="flex h-10 w-10 items-center justify-center rounded-lg text-white hover:bg-white/10 transition-colors">
                                <span class="material-symbols-outlined text-2xl">close</span>
                            </a>
                            <h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">Nghe & Viết</h2>
                        </div>
                        <button
                            class="flex items-center gap-2 rounded-lg px-3 py-2 text-primary transition-colors hover:bg-primary/10">
                            <span class="material-symbols-outlined text-xl">help</span>
                            <span class="text-sm font-semibold">Trợ giúp</span>
                        </button>
                    </header>

                    <main class="flex flex-1 flex-col justify-between overflow-y-auto p-4">
                        <div class="flex flex-col gap-2 pt-2">
                            <p class="text-sm font-normal text-slate-400">{{ currentQuestionIndex + 1 }}/{{
                                questions.length }}</p>
                            <div class="h-2 rounded-full bg-slate-700">
                                <div class="h-2 rounded-full bg-primary transition-all duration-300"
                                    [style.width.%]="((currentQuestionIndex + 1) / questions.length) * 100"></div>
                            </div>
                        </div>

                        <div class="flex flex-grow flex-col items-center justify-center gap-8 py-8"
                            *ngIf="!showResult && questions.length > 0">
                            <p class="text-lg font-semibold text-white">Nghe và điền vào chỗ trống</p>
                            <div class="flex flex-col items-center gap-6">
                                <button (click)="playAudio()"
                                    class="flex h-24 w-24 items-center justify-center rounded-full bg-primary text-white shadow-lg shadow-primary/30 transition-transform active:scale-95">
                                    <span class="material-symbols-outlined text-5xl">volume_up</span>
                                </button>
                                <p class="text-sm font-medium text-slate-400">Nhấn để nghe</p>
                            </div>
                        </div>

                        <div class="flex flex-col gap-4" *ngIf="!showResult && questions.length > 0">
                            <div class="relative">
                                <input type="text" [(ngModel)]="questions[currentQuestionIndex].userAnswer"
                                    (keyup.enter)="checkAnswer()"
                                    [disabled]="questions[currentQuestionIndex].isCorrect !== null"
                                    class="w-full rounded-xl border-2 border-slate-700 bg-slate-800 py-4 pl-4 pr-12 text-base text-white placeholder-slate-500 focus:border-primary focus:ring-primary/50 focus:ring-2"
                                    placeholder="Nhập câu trả lời của bạn">
                            </div>

                            <!-- Feedback -->
                            <div *ngIf="questions[currentQuestionIndex].isCorrect === true"
                                class="mt-2 rounded-lg bg-green-500/10 p-4 text-center text-green-400 border border-green-500/20">
                                <p class="font-bold">Chính xác!</p>
                            </div>
                            <div *ngIf="questions[currentQuestionIndex].isCorrect === false"
                                class="mt-2 rounded-lg bg-red-500/10 p-4 text-center text-red-400 border border-red-500/20">
                                <p class="font-bold">Đáp án đúng: {{ questions[currentQuestionIndex].word.term }}</p>
                            </div>
                        </div>

                        <!-- Result View Mobile -->
                        <div *ngIf="showResult" class="flex flex-col items-center justify-center h-full text-center">
                            <div
                                class="mb-6 inline-flex h-24 w-24 items-center justify-center rounded-full bg-primary/20">
                                <span class="material-symbols-outlined text-5xl text-primary">emoji_events</span>
                            </div>
                            <h3 class="mb-4 text-3xl font-bold text-white">Hoàn thành!</h3>
                            <p class="mb-8 text-xl text-gray-300">Bạn đã trả lời đúng <span
                                    class="font-bold text-primary">{{ score }}</span> / {{ questions.length }} câu.</p>
                            <div class="flex justify-center gap-4 w-full">
                                <button (click)="resetGame()"
                                    class="flex-1 rounded-xl bg-slate-700 px-6 py-4 font-bold text-white hover:bg-slate-600">Làm
                                    lại</button>
                                <a [routerLink]="['/vocabulary', course.id]"
                                    class="flex-1 rounded-xl bg-primary px-6 py-4 font-bold text-white hover:bg-primary/90">Về
                                    bài học</a>
                            </div>
                        </div>
                    </main>

                    <footer
                        class="w-full max-w-md bg-gradient-to-t from-background-dark via-background-dark/90 to-transparent p-4 pt-8"
                        *ngIf="!showResult">
                        <button (click)="checkAnswer()"
                            [disabled]="!questions[currentQuestionIndex].userAnswer || questions[currentQuestionIndex].isCorrect !== null"
                            class="flex h-14 w-full cursor-pointer items-center justify-center rounded-xl bg-primary text-lg font-bold leading-normal tracking-wide text-white shadow-lg shadow-primary/30 transition-colors hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed">
                            Kiểm tra
                        </button>
                        <button *ngIf="questions[currentQuestionIndex].isCorrect !== null" (click)="skipQuestion()"
                            class="mt-2 flex h-14 w-full cursor-pointer items-center justify-center rounded-xl bg-slate-700 text-lg font-bold leading-normal tracking-wide text-white shadow-lg transition-colors hover:bg-slate-600">
                            Tiếp theo
                        </button>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop View (hidden md:block) -->
    <main class="hidden md:block mx-auto max-w-3xl px-4 py-12 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <div class="mb-6 flex items-center gap-2 text-sm text-gray-400">
            <a routerLink="/vocabulary" class="hover:text-white transition-colors">Luyện tập</a>
            <span class="material-symbols-outlined text-xs">chevron_right</span>
            <a [routerLink]="['/vocabulary', course.id]" class="hover:text-white transition-colors">Từ vựng {{
                course.title }}</a>
            <span class="material-symbols-outlined text-xs">chevron_right</span>
            <span class="text-white">Bài tập Nghe & Viết</span>
        </div>

        <div class="mb-8 text-center">
            <h2 class="text-3xl sm:text-4xl font-bold text-white">Bài tập Nghe & Viết: {{ course.title }}</h2>
            <p class="mt-4 text-lg text-gray-400">Lắng nghe và nhập lại từ bạn nghe được vào ô bên dưới.</p>
        </div>

        <!-- Progress -->
        <div class="mb-8">
            <div class="flex justify-between text-sm font-medium text-white/70 mb-2">
                <span>Tiến độ</span>
                <span>Câu {{ currentQuestionIndex + 1 }}/{{ questions.length }}</span>
            </div>
            <div class="h-2 w-full rounded-full bg-[#334155]">
                <div class="h-2 rounded-full bg-[#22c55e] transition-all duration-300"
                    [style.width.%]="((currentQuestionIndex + 1) / questions.length) * 100"></div>
            </div>
        </div>

        <div *ngIf="!showResult && questions.length > 0" class="flex flex-col items-center">
            <!-- Audio Player -->
            <button (click)="playAudio()"
                class="mb-12 flex h-32 w-32 sm:h-40 sm:w-40 items-center justify-center rounded-full bg-primary text-white shadow-2xl transition-transform hover:scale-105 hover:bg-primary/90">
                <span class="material-symbols-outlined text-5xl sm:text-6xl">volume_up</span>
            </button>

            <div class="w-full max-w-md">
                <label class="mb-2 block text-sm font-bold text-white">Câu trả lời của bạn</label>
                <input type="text" [(ngModel)]="questions[currentQuestionIndex].userAnswer"
                    (keyup.enter)="checkAnswer()" [disabled]="questions[currentQuestionIndex].isCorrect !== null"
                    class="w-full rounded-lg border border-[#334155] bg-[#1e293b] px-4 py-4 text-lg text-white placeholder-gray-500 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
                    placeholder="Nhập lại từ bạn đã nghe...">

                <!-- Feedback -->
                <div *ngIf="questions[currentQuestionIndex].isCorrect === true"
                    class="mt-6 rounded-lg bg-green-500/10 p-4 text-center text-green-400 border border-green-500/20">
                    <p class="font-bold">Chính xác! Đáp án là: {{ questions[currentQuestionIndex].word.term }}</p>
                </div>
                <div *ngIf="questions[currentQuestionIndex].isCorrect === false"
                    class="mt-6 rounded-lg bg-red-500/10 p-4 text-center text-red-400 border border-red-500/20">
                    <p class="font-bold">Sai rồi. Đáp án đúng là: {{ questions[currentQuestionIndex].word.term }}</p>
                </div>

                <div class="mt-12 flex items-center justify-between gap-4">
                    <button (click)="skipQuestion()" [disabled]="questions[currentQuestionIndex].isCorrect !== null"
                        class="rounded-lg bg-[#334155] px-8 py-3 font-bold text-white hover:bg-[#475569] disabled:opacity-50 disabled:cursor-not-allowed">
                        Bỏ qua
                    </button>
                    <button (click)="checkAnswer()"
                        [disabled]="!questions[currentQuestionIndex].userAnswer || questions[currentQuestionIndex].isCorrect !== null"
                        class="rounded-lg bg-[#22c55e] px-8 py-3 font-bold text-white hover:bg-[#16a34a] disabled:opacity-50 disabled:cursor-not-allowed">
                        Kiểm tra
                    </button>
                </div>
            </div>
        </div>

        <div *ngIf="showResult" class="rounded-2xl bg-[#1e293b] p-12 text-center shadow-xl border border-white/5">
            <div class="mb-6 inline-flex h-24 w-24 items-center justify-center rounded-full bg-primary/20">
                <span class="material-symbols-outlined text-5xl text-primary">emoji_events</span>
            </div>
            <h3 class="mb-4 text-3xl font-bold text-white">Hoàn thành!</h3>
            <p class="mb-8 text-xl text-gray-300">Bạn đã trả lời đúng <span class="font-bold text-primary">{{ score
                    }}</span> / {{ questions.length }} câu.</p>
            <div class="flex justify-center gap-4">
                <button (click)="resetGame()"
                    class="rounded-lg bg-[#334155] px-8 py-3 font-bold text-white hover:bg-[#475569]">Làm lại</button>
                <a [routerLink]="['/vocabulary', course.id]"
                    class="rounded-lg bg-primary px-8 py-3 font-bold text-white hover:bg-primary/90">Về bài học</a>
            </div>
        </div>
    </main>
</div>