<div class="min-h-screen bg-[#102220] font-sans text-white">
    <main *ngIf="rule" class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">

            <!-- Sidebar -->
            <aside class="lg:col-span-3 lg:sticky lg:top-28 self-start">
                <div
                    class="flex h-full flex-col justify-between gap-6 bg-transparent p-4 rounded-xl border border-white/10">
                    <div class="flex flex-col gap-4">
                        <div class="flex flex-col">
                            <h3 class="text-white text-base font-medium leading-normal">Nội dung chính</h3>
                            <p class="text-white/60 text-sm font-normal leading-normal">Điều hướng nhanh</p>
                        </div>
                        <div class="flex flex-col gap-2">
                            <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors cursor-pointer"
                                (click)="scrollToSection('cong-thuc')">
                                <span class="material-symbols-outlined text-[#2beede] text-xl">functions</span>
                                <p class="text-white text-sm font-medium leading-normal">Công thức</p>
                            </a>
                            <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/20 transition-colors cursor-pointer"
                                (click)="scrollToSection('cach-dung')">
                                <span class="material-symbols-outlined text-white/80 text-xl">help_center</span>
                                <p class="text-white text-sm font-medium leading-normal">Cách dùng</p>
                            </a>
                            <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/20 transition-colors cursor-pointer"
                                (click)="scrollToSection('dau-hieu')">
                                <span class="material-symbols-outlined text-white/80 text-xl">visibility</span>
                                <p class="text-white text-sm font-medium leading-normal">Dấu hiệu nhận biết</p>
                            </a>
                        </div>
                    </div>
                    <button [routerLink]="['/grammar', rule.id, 'exercise']"
                        class="w-full flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-4 bg-[#2beede] text-[#102220] text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90 transition-opacity">
                        <span class="truncate">Làm bài tập ngay</span>
                        <span class="material-symbols-outlined ml-2 text-base">arrow_forward</span>
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <div class="lg:col-span-9 flex flex-col gap-8">
                <!-- Breadcrumb & Title -->
                <div class="flex flex-col gap-4">
                    <div class="flex flex-wrap gap-2">
                        <a class="text-white/60 hover:text-white text-sm font-medium leading-normal transition-colors"
                            routerLink="/">Trang chủ</a>
                        <span class="text-white/60 text-sm font-medium leading-normal">/</span>
                        <a class="text-white/60 hover:text-white text-sm font-medium leading-normal transition-colors"
                            routerLink="/grammar">Ngữ pháp</a>
                        <span class="text-white/60 text-sm font-medium leading-normal">/</span>
                        <span class="text-white text-sm font-medium leading-normal">{{ cleanTitle(rule.name_vi)
                            }}</span>
                    </div>
                    <div class="flex flex-wrap justify-between gap-3">
                        <h1 class="text-white text-4xl lg:text-5xl font-black leading-tight tracking-[-0.033em]">
                            {{ cleanTitle(rule.name_vi) }} - {{ rule.name_en }}
                        </h1>
                    </div>
                </div>

                <!-- 1. Công thức (Formulas) -->
                <section class="flex flex-col gap-4 p-6 bg-[#182C2A] rounded-xl border border-white/10" id="cong-thuc">
                    <h2 class="text-2xl font-bold text-[#2beede]">1. Công thức (Formulas)</h2>

                    <div *ngIf="rule.formulas" class="flex flex-col gap-3">
                        <!-- Khẳng định -->
                        <details class="flex flex-col rounded-lg bg-white/5 px-4 py-2 group" open>
                            <summary class="flex cursor-pointer items-center justify-between gap-6 py-2 list-none">
                                <p class="text-white text-base font-medium leading-normal">Khẳng định</p>
                                <span
                                    class="material-symbols-outlined text-white group-open:rotate-180 transition-transform">expand_more</span>
                            </summary>
                            <div class="text-white/80 text-sm font-normal leading-normal pb-2 space-y-2">
                                <p class="font-mono bg-[#102220] p-3 rounded-md">{{ rule.formulas.affirmative }}</p>
                            </div>
                        </details>

                        <!-- Phủ định -->
                        <details class="flex flex-col rounded-lg bg-white/5 px-4 py-2 group">
                            <summary class="flex cursor-pointer items-center justify-between gap-6 py-2 list-none">
                                <p class="text-white text-base font-medium leading-normal">Phủ định</p>
                                <span
                                    class="material-symbols-outlined text-white group-open:rotate-180 transition-transform">expand_more</span>
                            </summary>
                            <div class="text-white/80 text-sm font-normal leading-normal pb-2 space-y-2">
                                <p class="font-mono bg-[#102220] p-3 rounded-md">{{ rule.formulas.negative }}</p>
                            </div>
                        </details>

                        <!-- Nghi vấn -->
                        <details class="flex flex-col rounded-lg bg-white/5 px-4 py-2 group">
                            <summary class="flex cursor-pointer items-center justify-between gap-6 py-2 list-none">
                                <p class="text-white text-base font-medium leading-normal">Nghi vấn</p>
                                <span
                                    class="material-symbols-outlined text-white group-open:rotate-180 transition-transform">expand_more</span>
                            </summary>
                            <div class="text-white/80 text-sm font-normal leading-normal pb-2 space-y-2">
                                <p class="font-mono bg-[#102220] p-3 rounded-md">{{ rule.formulas.interrogative }}</p>
                            </div>
                        </details>
                    </div>

                    <!-- Fallback for simple structure -->
                    <div *ngIf="!rule.formulas && rule.structure"
                        class="font-mono bg-[#102220] p-4 rounded-md text-white/80">
                        {{ rule.structure }}
                    </div>
                </section>

                <!-- 2. Cách dùng & Ví dụ (Usage & Examples) -->
                <section class="flex flex-col gap-4 p-6 bg-[#182C2A] rounded-xl border border-white/10" id="cach-dung">
                    <h2 class="text-2xl font-bold text-[#2beede]">2. Cách dùng & Ví dụ (Usage & Examples)</h2>

                    <div *ngIf="rule.usages" class="text-white/80 space-y-4 leading-relaxed">
                        <div *ngFor="let usage of rule.usages">
                            <h3 class="text-white font-semibold mb-1">{{ usage.title }}</h3>
                            <div *ngFor="let example of usage.examples"
                                class="mt-1 pl-4 border-l-2 border-[#2beede]/50 italic">
                                <p><span class="text-[#2beede] font-semibold">Ví dụ:</span> {{ example.sentence }}</p>
                                <p class="text-white/60 text-sm">{{ example.translation }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Fallback for simple usage -->
                    <div *ngIf="!rule.usages && rule.usage" class="text-white/80 leading-relaxed whitespace-pre-line">
                        {{ rule.usage }}
                    </div>
                </section>

                <!-- 3. Dấu hiệu nhận biết (Signal Words) -->
                <section *ngIf="rule.signal_words && rule.signal_words.length > 0"
                    class="flex flex-col gap-4 p-6 bg-[#182C2A] rounded-xl border border-white/10" id="dau-hieu">
                    <h2 class="text-2xl font-bold text-[#2beede]">3. Dấu hiệu nhận biết (Signal Words)</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-white/90">
                        <span *ngFor="let word of rule.signal_words"
                            class="bg-white/5 text-center p-2 rounded-md text-sm">
                            {{ word }}
                        </span>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Loading State -->
    <div *ngIf="!rule" class="flex items-center justify-center min-h-screen">
        <div class="animate-pulse text-white/60">Đang tải...</div>
    </div>
</div>